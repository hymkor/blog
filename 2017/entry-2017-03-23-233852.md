```header
Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2017/03/23/233852
Rem: App-Edited: 2017-03-24T17:55:58+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/10328749687230037072
Rem: Published: 2017-03-23T23:38:52+09:00
Category:
Updated: 2017-03-23T23:38:52+09:00
Title: ☭（U+262D）のコマンドプロンプトに置ける文字の幅問題
```
☭という記号がある。「鎌と槌」（HAMMER AND SICKLE）と呼ばれる記号で、いわゆる共産党のシンボルである。

この文字、[East_Asian_Width は Neutral になっている](http://unicode.org/cldr/utility/character.jsp?a=262D&B1=Show)。
[Wikipediaの東アジアの文字幅](https://ja.wikipedia.org/wiki/%E6%9D%B1%E3%82%A2%E3%82%B8%E3%82%A2%E3%81%AE%E6%96%87%E5%AD%97%E5%B9%85)によると

    UAX#11では、これらの特性を次のように解釈することを推奨している。
    
    Unicode のテキストを東アジアの従来文字コードの文脈で扱う場合
    - 特性値Na（狭）またはN（中立）を持つ文字は、半角の文字 (halfwidth) として扱う
      :
    Unicode のテキストを東アジア以外の従来文字コードの文脈で扱う場合
    - 特性値Na（狭）またはN（中立）を持つ文字は、幅の狭い文字 (narrow) として扱う。

であるため、規格上はいわゆる「半角文字」である。

が、コマンドプロンプトで実際に出力すると、セルを二つ消費する。つまり、「全角文字」相当になっている。

これが原因で [go-runewidth](https://github.com/mattn/go-runewidth) をそのまま使って、文字の桁数を計算することができなくなっている。仕方がないので、実際にコマンドプロンプトに出力した時のカーソル移動量で文字の桁数を求めている。

[NYAGOS の一行入力パッケージ](https://github.com/zetamatta/nyagos/readline)では、極力 [go-colorable](https://github.com/mattn/go-colorable) によるエスケープシーケンスだけで処理を済まそうとしているが、一部どうしてもコンソールの API を直接呼び出している。この文字桁問題がなければ、ひとつ直接呼出しが減らせるんだけどな…
