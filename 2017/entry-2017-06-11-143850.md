Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2017/06/11/143850
Rem: App-Edited: 2017-06-18T17:47:02+09:00
Rem: Draft: yes
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/13355765958054485465
Rem: Published: 2017-06-11T14:38:50+09:00
Category: git
Updated: 2017-06-11T14:38:50+09:00
Title: gitで特定のフォルダーだけ抽出して別のレポジトリにする（手動編）
---
今後、何回もやることになったら、手順の改善や自動化を検討するということで、
とりあえず、今回の手順のメモ

---

https://github.com/zetamatta/experimental というレポジトリで、実験的な開発とか、コードのお試しとかやっている。
最近、[experimental/tail](https://github.com/zetamatta/experimental/tree/master/tail) というサブフォルダーで作っていた
「自作 tail」がまぁまぁ満足行く出来になったので、別のレポジトリに独立させたいと思った。

**留意事項：experimental/tail は最初 experimental/tailf というフォルダーだったが、途中でリネームした。**

0. 作業用に普段とは別の場所にクローンする
   * `git clone https://github.com/zetamatta/experimental`
   * `cd experimental`
0. 事故を起こさないよう、リモートブランチとのリンクを削除しておく
    * `git remote remove origin`
1. /tail で更新したコミットの一覧を得る。
    * `git log tail/`
    * コミットを全部コピーしておく
2. /tail で更新した最初のコミットの一つ前に戻る
    * `git checkout (tail以下の最初のコミット)~1`
3. /tailf で更新したコミットの一覧を得る。
    * `git log tailf/`
    * こちらも 1. 同様コミットを全部コピーしておく（これで全部）
4. git で本当に最初のコミットにまで戻る
    * `git checkout （全ファイルでの最初のコミット）`
    * 自分はレポジトリを作った直後、いつも空状態で１回 commit するようにしているので、そこまで戻る
5. 新しいブランチを作る
    * `git branch tail`
    * `git checkout tail`
    * このあたりはミスったので、若干手順があいまい
6. 新しいブランチで 1. と 3. のコミットを全部、古いものから順に cherry-pick する
    * `git cherry-pick コミット名`
    * これを繰り返し
7. マスターブランチと入れ替える
    * `git branch -D master`
    * `git branch -m tail master`
8. github に新しいレポジトリ https://github.com/zetamatta/tail を作成して、push する
    * `git remote add origin https://github.com/zetamatta/tail`
    * `git push`

---

複数フォルダーを同時に commit していたりすると、こういう操作は無理になる。
（今回はフォルダーのリネーム１回だけだったりしたので何とかなった）

追記
===

* 「1.」と「3.」は `git log --pretty="format:%H" -- tail tailf` で Ok
     * `--` をつければ、その時点で存在しないフォルダーも指定可能
     * ただし、ファイル名の変更などは `git log --stat` (ログにファイル名も表示)で事前に確認した方がよい

