Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2017/06/15/211248
Rem: App-Edited: 2017-06-18T17:46:29+09:00
Rem: Draft: yes
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/8599973812270303976
Rem: Published: 2017-06-15T21:12:48+09:00
Category:
Updated: 2017-06-15T21:12:48+09:00
Title: gitで特定のフォルダーだけ抽出して別のレポジトリにする（手動編２）
---
こんなバッチファイル（exlucde.cmd）を作った

```
git log --stat %*
git log --pretty="format:%%H" -- %* | lua -e "buffer={} ; for line in io.lines() do buffer[#buffer+1] = line ; end ; for i=#buffer,1,-1 do print('git cherry-pick '.. buffer[i]) end" > pick.cmd
```

最初の `git log --stat` は人間向けにファイルの追加・削除を表示させているだけで、特に重要ではない。
二行目の `git log --pretty="format:%%H" -- %*` は、対象となるフォルダーの commit 一覧を出している。
続く、パイプラインの lua は順番を逆転させて、各 commit に対する `git cherry-pick` を発行するバッチ `pick.cmd` を作成している。

このバッチを実行した後は

- `git checkout (最初のコミット)`
- `pick.cmd` で、特定のフォルダーを含む commit だけを取り込む
- `git rebase -i --root` で最初の（不要な）commitを削除する （[参考](http://d.hatena.ne.jp/ken_c_lo/20130421/1366558065)）

…と前の記事とだいたい同じ


