Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2017/09/22/131526
Rem: App-Edited: 2024-01-21T11:50:05+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/8599973812300357424
Rem: Published: 2017-09-22T13:15:26+09:00
Category: Windows7 PowerShell
Updated: 2017-09-22T13:15:26+09:00
Title: ファイルサーバ名が変わったので、リンク切れした「お気に入り」を修復
---
Windows7のエクスプローラで出てくる「お気に入り」は、`%USERPROFILE%\Links` というフォルダーにショートカットが全部並んでいる。
PowerShell を使って全部リネームしよう、そうしよう。

```
$fromName = "\\旧サーバ名\"
$toName = "\\新サーバ名\"

$wsh = New-Object -ComObject WScript.Shell
Get-ChildItem (Join-Path $env:userprofile "Links") | %{
    if( $_.Extension -eq ".lnk" ){
        $shortcut = $wsh.CreateShortcut($_.FullName)
        $target = $shortcut.TargetPath
        if( $target.StartsWith($fromName) ){
            $newTarget = $toName + $target.substring($fromName.Length)
            if( Test-Path $newTarget ){
                Write-Output ("    " + $target)
                Write-Output ("--> " + $newTarget)
                $shortcut.TargetPath = $newTarget
                $shortcut.Save()
            }
        }
    }
}
```

* [Tech TIPS：PowerShellのGet-ChildItemコマンドレットでファイル名の一覧を取得する（応用編） - ＠IT](http://www.atmarkit.co.jp/ait/articles/0808/29/news131.html)
* [PowerShell でショートカットを作る](http://www.vwnet.jp/Windows/PowerShell/CreateShortcutByPowerShell.htm)
* [PowerShell HOME : HIRO's.NET](http://hiros-dot.net/PowerShell/index.htm)
