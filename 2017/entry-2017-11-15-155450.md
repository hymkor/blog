Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2017/11/15/155450
Rem: App-Edited: 2017-11-15T16:39:14+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/8599973812317994569
Rem: Published: 2017-11-15T16:39:14+09:00
Category:
Updated: 2017-11-15T15:54:50+09:00
Title: Lua 5.1 向け shebang for Windows
---
```
@lua5.1.exe -e "_,_,b=io.input([[%~f0]]):read('*l','*l','*a');assert(loadstring('\n'..b,[[%~f0]]))()"
@exit /b %ERRORLEVEL%

print('ahaha')
x
```

5行目にわざと Lua としては不適切な文字 `x` を入れている。これを実行すると

```
lua: (command line):1: [string "C:\Users\USERNAME\foo.cmd"]:5: syntax error near <
eof>
stack traceback:
        [C]: in function 'assert'
        (command line):1: in main chunk
        [C]: in ?
exit status 1
```

5行目がおかしいというエラーがちゃんと出る。`x` を消すと

```
$ foo
ahaha
```

とちゃんと実行される。

- [インタプリタ無改造！ Lua on Windows で shebang - Qiita](https://qiita.com/hymkor/items/4f0c1d4c3f1fa76d8e4c)
    - Lua 5.3 向け。5.1 には、このようなラベル構文はないので、そのまま使えない