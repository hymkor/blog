```header
Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2017/11/19/165859
Rem: App-Edited: 2017-11-20T02:20:33+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/8599973812319188640
Rem: Published: 2017-11-19T16:58:59+09:00
Category: go
Updated: 2017-11-19T16:58:59+09:00
Title:  うっかり、オレオレ grep (seek)を書いてしまった。
```
先日、`while( <> ){ }` 的なものの Go 版ライブラリ [argf](http://zetamatta.hatenablog.com/entry/2017/11/11/133957)を書いてみたわけだけれども、そのサンプルとして 簡単な grep (seek)を書いてみた。

- <del>https://github.com/zetamatta/experimental/tree/master/seek<br />
   (また、例によって、実験用レポジトリ experimental ですわ。バイナリなしのソースのみ）</del><br />
  <ins>https://github.com/zetamatta/seek</ins>  

最初は必要最小限にしていたんだけど、[jvgrep](https://github.com/mattn/jvgrep) みたいに「**検索文字列の部分をハイライト表示**」できないかなと思って頑張ってみたら、Go言語のライブラリが充実していることもあって、案外簡単に出来てしまった。

で、調子にのって、自分が grep に望む機能を実装してみた。

- UTF8 と ANSI(現在のコードページマルチバイト文字列：日本なら SJIS～CP932)の行単位での簡易自動判定
    - UTF8 と解釈できなければ、ANSI と判断するという安直判定
    - 前は ShiftJIS の時は Windows 標準の findstr.exe、UTF8 なら [jvgrep](https://github.com/mattn/jvgrep) を使っていたが、いちいち使い分けるのは面倒くさかった。
    - jvgrep はテキストファイルチェックが厳しくて、すぐバイナリファイル扱いにしてしまう。
    - git で SJIS テキストの差分を見る時、git の UTF8 と、本文の SJIS が混ざってしまう。両方とも化けずに見たい場合があるので、行単位で別々の文字コード判定にしたかった。

本当に自分が必要とした機能しか入れていないので、以下のような制限がある

- オプションは `-i` （大文字・小文字を区別しない）、`-r`（再帰的にファイルを検索する）だけ
- 速度はあまり重視しておらず、工夫なし
- 常にカラー表示。「リダイレクトしていたらエスケープシーケンスを抑制」とか別にしない
- 色使いは [jvgrep](https://github.com/mattn/jvgrep) の<del>パクリ</del> <ins>互換</ins>

貴殿も、オレオレ grep を作ってみませんか？
