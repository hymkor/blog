```header
Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2019/03/18/051039
Rem: App-Edited: 2019-05-07T22:45:47+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/17680117126995276351
Rem: Published: 2019-03-18T05:10:39+09:00
Category: batchfile
Updated: 2019-03-18T05:10:39+09:00
Title: ネットワークドライブを維持したまま、管理者モードに昇格したコマンドプロンプトを起動する
```
```
setlocal
call :"%1"
endlocal
exit /b

:"install"
    powershell "start-process -FilePath 'cmd.exe' -ArgumentList ('/s /c '+[char]34+((get-wmiobject win32_networkconnection | %%{ 'net use '+$_.LocalName+' '+[char]34+$_.RemoteName+[char]34 }) -join ' & ') + ' & ' + [char]34 + '%~dpnx0' + [char]34 + ' _install' + [char]34) -verb 'runas'"
    exit /b

:"_install"
    cd /D "%~dp0"
    pause
    exit /b
```

ユーザは `make install` を実行する。UAC ダイアログが表示されるので「はい」を選択すると、管理者モードで `:"_install"` ラベル以降が実行される。この時、通常モードのドライブレターは管理者モードでも継承されている。
