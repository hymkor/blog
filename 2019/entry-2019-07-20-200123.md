Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2019/07/20/200123
Rem: App-Edited: 2023-04-29T10:12:25+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/26006613375296726
Rem: Published: 2019-07-20T20:01:23+09:00
Category: vmware
Updated: 2019-07-20T20:01:23+09:00
Title: VMware Workstation 12 のイメージがディスクを圧迫してきたので整理した
---
どうも VMware はバージョンやエディションによって、インターフェースがだいぶと違うようで、ググっても違う製品向けのものが出てきてしまう。

試行錯誤の結果、下記の手順でディスク消費を減らした。  
（10個ちかく VM があったのだが、500GB くらい浮いた）

* 不要なスナップショットを削除する
     * ただし、この時点ではディスクは開放されない（ように見える）
* 「VM(<U>M</U>)」→「管理(<U>M</U>)」→「ディスクのクリーンアップ」
    * こちらは確実にディスクが解放される（ようだ）
    * この機能の場所が分からなくて、今まで放置していたのは秘密だ。
* 使用していない VM の削除
    * 「ファイル(<U>F</U>)」→ 「OVF へのエクスポート(<U>E</U>)」で、OVF フォーマットでエクスポートする
    * 「VM(<U>M</U>)」→「管理(<U>M</U>)」→「ディスクから削除(<U>D</U>)」
    * エクスポートした OVF ファイル一式は DropBox のフォルダーにおいて、スマートシンクで「オンラインのみ」にすることで、ローカルディスクの消費容量をゼロにする（会社の DropBox はアホほど容量が余っているのだ）
    * 削除した VM がクローンの場合、クローン元の VM のクローン時のバックアップも削除してよくなる（はず)

なお、今回はリストアのテストまでしていないので、もしかしたらインポートできないという事態もありえないともいえない。真似る時は OWN YOUR RISK で頼む

#### （備考）リンククローンについて

* リンククローンして作った VM は、仮想マシンの詳細欄に「クローン： **クローン元のイメージのパス** 」が表示される
     * このVMでは、イメージファイルのフルコピーはバックアップにならない（リストア時にクローン元のVMも必要になる）。OVFファイルにエクスポートした方がよい
* リンククローンを過去作ったことがある VM は、スナップショットマネージャで見た時に、リンククローンした時のスナップショットが自動作成される。これを削除しようとすると警告される。
     * クローン先のイメージを完全削除しないとリンク時のスナップショットを消すわけにはいかない

以上