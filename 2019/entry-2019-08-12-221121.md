Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2019/08/12/221121
Rem: App-Edited: 2019-08-12T22:11:21+09:00
Rem: Draft: yes
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/26006613382579155
Rem: Published: 2019-07-31T22:26:32+09:00
Category:
Updated: 2019-08-12T22:11:21+09:00
Title: WindowsでホストOS/ゲストOS/DropBox などで bin などを共有する
---
自分は：

- 32bit のゲストOSのWindows
- 64bit のゲストOSのWindows
- 64bit のホストOSのWindows
- 会社PC / 自宅PC

で、bin などを共有している。

基本のディレクトリ構造は下記のとおり：

- %USERPROFILE%
   - DropBox … 会社⇔自宅の共有用。ただし、直接パスは参照させない
        - Share\bin64 (64bit の実行ファイル) 
        - Share\bin (32bit の実行ファイル)
        - cmds (バッチファイル)
        - etc (設定ファイル)
    - Share
        - bin64 (64bit の実行ファイル) … mklink /J bin64 "%USERPROFILE%\DropBox\Share
        - bin (32bitの実行ファイル)
        - cmds (バッチファイル)
        - etc (設定ファイル)
        - Program Files (アプリケーションのフォルダー置き場)

- Share は VMware の共有フォルダーに指定する
- ゲストOSでは、以下の２つの方法で共有する
    - `mklink /D "%USERPROFILE%\Share" "\\vmware-host\Shared Folders\Share"`
    - `net use Z: "\\vmware-host\Shared Folders"`

#### NYAGOS の設定

- nyagos は bin64 に 64bit 版、bin に32bit版を置く
- %USERPROFILE%直下はゲストとホストで共有できないため、%USERPROFILE%\.nyagos はいちいち VM ごとにおかねばならないが、それは面倒
- そこで、%USERPROFILE%\Share\bin64\.nyagos , %USERPROFILE%\Share\bin\.nyagos を使うようにする。
- だが、bin64\.nyagos と bin\.nyagos に同じことを書くのは保守性が低ので、以下のように etc\nyagos.lua を include して、共通する内容はそちらに書くようにする


```lua
local baseDir,_ = string.gsub(nyagos.exe,"\\[^\\:]+\\[^\\:]+$","")
local dotnyagos=nyagos.pathjoin(baseDir , "Etc\\nyagos.lua")

local fd=io.open(dotnyagos)
if fd then
    fd:close()
    print("loadfile " .. dotnyagos)
    assert(loadfile(dotnyagos))()
end

-- Share\bin64\.nyagos の方だけ以下を書く
nyagos.exec("set PATH+="..nyagos.pathjoin(baseDir,"bin64"))
```