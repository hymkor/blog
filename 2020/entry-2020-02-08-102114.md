```header
Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2020/02/08/102114
Rem: App-Edited: 2023-04-28T22:41:12+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/26006613508463642
Rem: Published: 2020-02-08T10:21:14+09:00
Category: go
Updated: 2020-02-08T10:21:14+09:00
Title:  コマンドプロンプトでフォントサイズから全角・半角を区別する試み
```
現在のコマンドプロンプトでの文字列のピクセルサイズを測る API（gdi.dll のGetTextExtentPoint32W）を呼ぶパッケージを作成した。

* [zetamatta/go-windows-consolefontpixel](https://github.com/zetamatta/go-windows-consolefontpixel)

これを使って、引数のテキストの長さを測るプログラムを書いた。

```go
package main

import (
	"os"

	"github.com/zetamatta/go-windows-consolefontpixel"
)

func main1() error {
	dc, err := consolefontpixel.OpenDC()
	if err != nil {
		return err
	}
	defer dc.Close()

	for _, s := range os.Args[1:] {
		w, h, err := dc.GetTextExtentPoint(s)
		if err != nil {
			return err
		}
		println(s, ":width=", w, ",height=", h)
	}
	return nil
}

func main() {
	if err := main1(); err != nil {
		println(err.Error())
		os.Exit(1)
	}
}
```

やってみよう！

[f:id:zetamatta:20200208101445p:plain]

だめだ。こりゃ…

U+2727 : WHITE FOUR POINTED STAR は幅16ピクセル、高さ18ピクセルなのでほぼ全角サイズなのに、最後の行を見て分かるとおり画面に出力すると１セル分しかカーソルが移動していない。
（ちなみに Windows 7 では2セル動いていた → [コマンドプロンプトの文字幅をキャリブレーションして、崩れない TUI 画面を作ろう - 標準愚痴出力](http://zetamatta.hatenablog.com/entry/2019/12/15/142905) )

Windows 10 から、全角・半角判定はフォントサイズではなく、厳密な Unicode の規定に従うようにしたのだろうか
