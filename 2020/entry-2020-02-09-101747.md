```header
Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2020/02/09/101747
Rem: App-Edited: 2020-03-19T13:46:27+09:00
Rem: Draft: yes
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/26006613508881864
Rem: Published: 2020-02-09T10:17:47+09:00
Category: nyagos
Updated: 2020-02-09T10:17:47+09:00
Title:  nyagos で %PATH% がオーバーフローしないようにする対策
```
環境変数 PATH の文字数には 2000文字くらいの上限があるようで、これをオーバーして、必要なコマンドが呼び出せなくなるというトラブルが WSL あたりで発生しているようです。

nyagos でも問題は同様に発生しうるのですが、Lua コードで %PATH% にフォルダーを追加する前に、使わないフォルダーを除くことでオーバーフローしないようにすることが可能です。
（**削除しても nyagos と nyagos から呼び出される子プロセス内だけの話なので、他の動作には影響しない** ）

以前はそういうコードをゴリゴリ書く必要があったのですが、`4.4.5` から nyagos.envdel という関数が使えるようになって、整理が簡単になりました。

こんなふうに %USERPROFILE%\.nyagos に書きます。

```
nyagos.envdel("PATH",
    "Oracle","Lenovo","Skype",
    "chocolatey","TypeScript","WindowsApps",
    "Wbem","dotnet")
```

envdel 関数は、第一引数で示された環境変数内の `;` で区切られた要素から、第ニ引数以降の文字列を **含んでいるもの** を削除します。
上の例だと `Oracle` や `Lenovo` … といった文字列が含まれたフォルダーを %PATH% から除きます。

で、これをやって %PATH% の長さにゆとりがでたところで

```
nyagos.envadd("PATH",
    "C:\\go\\bin",
    "C:\\TDM-GCC-64\\bin",
    "%ProgramFiles%\\Git\\bin",
    "%ProgramFiles%\\Git\\cmd",
    "%ProgramFiles(x86)%\\Git\\bin",
    "%ProgramFiles(x86)%\\Git\\cmd",
    "%ProgramFiles%\\Subversion\\bin",
    "%ProgramFiles(x86)%\\Subversion\\bin",
    "~\\Share\\Program Files\\idmanager",
    "%VBOX_MSI_INSTALL_PATH%",
    "~\\bin",
    "~\\scoop\shims",
    "~\\Share\\bin",
    "~\\Share\\cmds")
```

とフォルダーを改めてドドンと足すことができるというわけです。

ね、簡単でしょ？
