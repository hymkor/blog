Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2020/03/16/221356
Rem: App-Edited: 2020-03-16T22:13:56+09:00
Rem: Draft: yes
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/26006613536282769
Rem: Published: 2020-03-16T22:13:56+09:00
Category:
Updated: 2020-03-16T22:13:56+09:00
Title: Visual Studio のコマンドラインクライアントを改造した(vf1s→vo)
---
昨年くらいから vf1s.exe という Visual Studio のクライアントを作ってきた。

* [そのソリューションを開くべき Visual Studio のバージョンは？ - 標準愚痴出力](https://zetamatta.hatenablog.com/entry/2019/08/09/143657)
* [Visual Studio のコマンドラインクライアントのラッパー vf1s を作った - 標準愚痴出力](https://zetamatta.hatenablog.com/entry/2019/06/22/160031)
* [*.vcxproj/vbproj/csproj のパーサーを書いているが、$(VCTargetsPath)の導出元がわからない - 標準愚痴出力](https://zetamatta.hatenablog.com/entry/2019/07/15/102429)

が、これ、いろんな動作を１実行ファイルにつっこんでいるくせに、その動作の変更を全部オプションでやっていたので、使い方がすごくわかりにくかった。

ということで、Go言語のアプリらしく、サブコマンドを使った形にインターフェイスを変えてみました。名前も打ちにくいから vo (Visual studio client for command line Operation) にしよう。

* [zetamatta/vo: Visual-studio client for command-line Operation](https://github.com/zetamatta/vo)

```
NAME:
   vo.exe - Visual studio solution commandline Operator

USAGE:
   vo.exe [global options] command [command options] [arguments...]

COMMANDS:
   ide      start visual-studio associated the solution with no options
   build    call devenv.com associated the solution with /build option
   rebuild  call devenv.com associated the solution with /rebuild option
   ls       list up expected executables inline
   list     list up existing executables and thier version-information with long format
   showver  Show the version information for executables given by parameters
   eval     eval the equation given by parameter
   help, h  Shows a list of commands or help for one command

GLOBAL OPTIONS:
   --2010      use Visual Studio 2010 (default: false)
   --2013      use Visual Studio 2013 (default: false)
   --2015      use Visual Studio 2015 (default: false)
   --2017      use Visual Studio 2017 (default: false)
   --2019      use Visual Studio 2019 (default: false)
   --latest    search Visual Studio order by the version descending (default: false)
   -w          show warnings (default: false)
   -v          verbose (default: false)
   --help, -h  show help (default: false)
```

サブコマンドを作るライブラリとして、"[urfave/cli](https://github.com/urfave/cli)" を使ったんですが、ヘルプがかっこよくできていいですね。

* `vo ide` … カレントディレクトリにあるソリューションファイルに対応した Visual Studio で開く
* `vo build` … ビルドする
* `vo rebuild` … リビルドする
* `vo ls` … ソリューションで作成される可能性のある実行ファイル名をインラインに列挙する
* `vo list` … `vo ls` で作成されうる実行ファイルのうち、実際に存在するものについて、バージョン情報などを添えて、ロングフォーマットで表示する。

再掲になるが、もう一度、このツールの特徴を列挙

* Visual Studio の実行ファイル(devenv.com) への %PATH% が通っていなくとも、ほぼ自動で場所を探す
* 複数の Visual Studio がインストールされていた場合でも、ソリューションファイルやプロジェクトファイルに記載された要件を満たす Visual Studio を呼び指す
* Visual Studio のバージョンを明示的に指定することもできるし、実行可能な要件を満たした Visual Studio のうち一番古いバージョン / 一番新しいバージョンどちらでも呼び出せる（デフォルトは要件を満たすうちで一番古いもの）






