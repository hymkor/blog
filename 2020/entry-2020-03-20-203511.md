```header
Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2020/03/20/203511
Rem: App-Edited: 2023-04-28T22:32:14+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/26006613538126204
Rem: Published: 2020-03-20T20:35:11+09:00
Category:
Updated: 2020-03-20T20:35:11+09:00
Title: Windows で git diff の結果を patch.exe で使う
```
「git 互換 patch」で検索すると、次のようなページがすぐ見つかる。

* [Git - パッチ互換のdiffを作成する | git Tutorial](https://riptutorial.com/ja/git/example/9533/%E3%83%91%E3%83%83%E3%83%81%E4%BA%92%E6%8F%9B%E3%81%AEdiff%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B)

こうか！

```
$ git show --no-prefix 5f682fb657439fe518475e6effc6e7e30b1dfd33 > patch.1
```

だが、Windows では、このパッチを適用すると

```
$ patch.exe < ../../patch.1
patching file readline.go
Assertion failed: hunk, file ../patch-2.5.9-src/patch.c, line 354       
```

とエラー終了してしまう。「patch assertion failed」でググると、すぐ対処方法を記載したページが見つかる。

* [patch.exe が異常終了してしまうときの対処](https://blogs.osdn.jp/2016/05/16/patch.html)

どうも、改行コードが  LF だと、こうなってしまうようだ。パッチコードの改行コードを変換してもいいんだが、お手軽にバイナリモードを使用した。

```
（パッチ作成）
$ git show --no-prefix 5f682fb657439fe518475e6effc6e7e30b1dfd33 > patch.1
（パッチ適用）
$ patch.exe --binary < ../../patch.1 
```

しかし、assertion failed は、ひどいよな。もうちょっとマシなエラーメッセージは出せなかったものか…

### 余談１：UAC ダイアログ版

patch.exe は WindowsXP 時代のものを使うと UACダイアログが起動してしまう（「patch」という名前を含んでいるせい）。UAC ダイアログが出ないバージョンは 次より配布されている

* [patch.exe ユーザーアカウント制御（UAC）対応版](https://blogs.osdn.jp/2015/01/13/patch.html)

### 余談２：-p オプション

パッチを作る側と、パッチを適用する場所で、ディレクトリの深さが違うと当然だが、パッチ適用が失敗する。

patch コマンドの -p オプションを使うと、パッチの相対パスの深さを減らすことができる。-p0 だとそのまま、-p1 だとディレクトリを一つ減らすという感じだ。
