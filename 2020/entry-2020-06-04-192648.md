```header
Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2020/06/04/192648
Rem: App-Edited: 2020-06-04T19:26:48+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/26006613579014747
Rem: Published: 2020-06-04T19:26:48+09:00
Category: golang
Updated: 2020-06-04T19:26:48+09:00
Title:  Go 1.14.4 で直ったという、Windows で O_CREATE | O_TRUNC で既存のファイル開くと読み取り専用なってしまうバグとは
```
* [os: opening an existing file with O_CREATE|O_TRUNC and permission 0 changes file to be read-only on Windows [1.14 backport] · Issue #39158 · golang/go](https://github.com/golang/go/issues/39158)

「あれ？これ nyagos のリダイレクトで発生するんじゃね？」と思ったが、発生しなかった。
どうやら、

* os.OpenFile の第３引数でパーミッションを０などにした時に発生する
    * nyagos は os.Create を使ってるし、パーミッションは基本的に 0 などにしない
* UNIX的な挙動としては、この第３引数は新規ファイルを作成する時だけ使うべきもので、 **既存のファイルを０バイトにしてから開く場合は適用されてはダメ** 
    * Windows 版も UNIX と同じような振る舞いをすべきなのに、そうなっておらず、新規ファイル・既存ファイル関係なく、パーミッションが変わってしまっていた。

というものらしいです。うん、関係なかったな！
