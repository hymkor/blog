```header
Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2021/05/07/063951
Rem: App-Edited: 2024-01-21T13:05:48+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/26006613725439989
Rem: Published: 2021-05-07T06:39:51+09:00
Category: Makefile
Updated: 2021-05-07T06:39:51+09:00
Title: nmake と set
```
nmake では set は CMD.EXE ではなく、nmake 自身の組み込みコマンドらしい

```make
test:
	set foo=ahaha
	echo %%foo%%
```

% は nmake用の Makefile ではファイル指定子であるため、２つ重ねなくてはいけない [※](https://docs.microsoft.com/ja-jp/cpp/build/reference/special-characters-in-a-makefile?view=msvc-160)

```
$ nmake

Microsoft (R) Program Maintenance Utility Version 10.00.30319.01
Copyright (C) Microsoft Corporation.  All rights reserved.

        set foo=ahaha
        echo %foo%
ahaha
```

二重引用符の扱いについて、CMD.EXE との互換性はない

```make
test:
	set "foo=ahaha"
	echo %%foo%%
	echo %%"foo%%
```

```
$ nmake

Microsoft (R) Program Maintenance Utility Version 10.00.30319.01
Copyright (C) Microsoft Corporation.  All rights reserved.

        set "foo=ahaha"
        echo %foo%
%foo%
        echo %"foo%
ahaha"
```

CMD.EXE の set を呼ぶには丸括弧で囲めば良い

```make
test1:
	set GOOS=linux & go env GOOS

test2:
	( set "GOOS=linux" & go env GOOS )
```

```
$ nmake test1

Microsoft (R) Program Maintenance Utility Version 10.00.30319.01
Copyright (C) Microsoft Corporation.  All rights reserved.                                                                                                                                  set GOOS=linux & go env GOOS
$ nmake test2

Microsoft (R) Program Maintenance Utility Version 10.00.30319.01
Copyright (C) Microsoft Corporation.  All rights reserved.                                                                                                                                  ( set "GOOS=linux" & go env GOOS )
linux
```
