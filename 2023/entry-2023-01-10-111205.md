Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2023/01/10/111205
Rem: App-Edited: 2024-01-21T13:00:30+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/4207112889952800507
Rem: Published: 2023-01-10T11:12:05+09:00
Category: Go
Updated: 2023-01-10T11:12:05+09:00
Title: scoop のマニフェストファイルを作るツールを公開しました
---
[https://github.com/hymkor/make-scoop-manifest:embed:cite]

本記事は https://twitter.com/NyaosOrg/status/1612296206193143809 以下のスレッドの転載になります。
scoop のマニフェストファイルとは何かについては、以下もご覧ください（本記事の記載内容と若干重複していますが）

- [scoop の野良パッケージの作り方｜scoop / nyagos で始めるコマンドライン生活](https://zenn.dev/zetamatta/books/5ac80a9ddb35fef9a146/viewer/bbbbbb)
- [おれおれ scoop バケットを作ろう｜scoop / nyagos で始めるコマンドライン生活](https://zenn.dev/zetamatta/books/5ac80a9ddb35fef9a146/viewer/cccccc)

-----

インストールは

```
 scoop bucket add hymkor https://github"."com/hymkor/scoop-bucket
 scoop install make-scoop-manifest
```

で OK です。ちょっと場合によって使い方がややこしいです。

###（１）レポジトリの場所は git remote show -n で取得し、ZIPファイルがローカルにある場合（コスト最小）

```
cd YOUR-REPOSITORY
make-scoop-manifest *.zip > YOUR-TOOL.json
```

マニフェストファイルをそのレポジトリ自身に格納する場合を想定しています。

### （２）レポジトリの場所はオプションで指定する場合

```
make-scoop-manifest -g USERNAME/REPOSITORY *.zip > YOUR-TOOL.json
```

これは自分の scoop のバケットをメンテする場合などに、別のフォルダーの複数のレポジトリのマニフェストファイルを作る場合を想定しています。

### （３）ZIP ファイルがそもそも手元にない場合

```
make-scoop-manifest -D -g USERNAME/REPOSITORY > YOUR-TOOL.json
```

内部的に ZIP ファイルを GitHub の Releases からダウンロードします。ローカルに何もなくても使えるのですが、ダウンロードカウントが一つ増えてしまいます

（３）は主に他人のプロダクトを自分のバケットに登録する場合などを想定しています。

オプション体系が今一分かりにくいのですが、もっとよいのが思いつかなかったし、こういうのってどうせ Makefile に組み込むものなので、そんなに使いやすくなくてもよいかな…ということで見切り発車です。

自分の場合の保守方針は、こんな次の感じです。

1. 各ツールのマニフェストファイルは、まずそのツール自身のレポジトリに git add して登録しておく
2. scoop-bucketレポジトリの保守バッチでは、各ツールのフォルダーからマニフェストファイルを ./bucket 以下にコピーするようにするだけ

自分の保守方針では結局（１）しか使ってないですね。これはとりあえず（１）を作ってから、もっと楽な保守の方法はないかなと思って、（２）→（３）を作ったものの、やっぱり影響範囲を考えると（１）を使うのが無難かなと迷走した結果です。

あと、あんまり複雑な ZIP ファイルは想定していません。マニフェストファイルでは "bin" という項目で実行ファイルを指定しますが、これは ZIP ファイルの中から拡張子 EXE のファイルを検索しているだけです。

アーキテクチャとして Interl の 32bit , 64bit がある想定なので、"386","amd64" という単語が ZIP ファイルの名前に入っている必要があります。また、scoop 用なので "linux" , "macos" が名前に入っているZIPファイルは無視されます。
