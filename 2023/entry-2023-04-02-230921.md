Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2023/04/02/230921
Rem: App-Edited: 2024-01-21T12:57:10+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/4207112889977355410
Rem: Published: 2023-04-02T23:09:21+09:00
Category: Go
Updated: 2023-04-02T23:09:21+09:00
Title: go-readline-nyï¼šã‚«ãƒ©ãƒ¼åŒ–ã®æ‰‹å¼•ã
---
**ï¼ˆ2023/04/14ï¼šè¿½è¨˜ï¼‰**  
v0.10.0 ã«ã¦éäº’æ›æ€§ã‚’å«ã‚€ä¿®æ­£ã‚’è¡Œã£ãŸãŸã‚ã€ãã®å¤‰æ›´ç‚¹ã‚’åæ˜ ã—ã¾ã—ãŸã€‚

---

[go-readline-ny]: https://github.com/nyaosorg/go-readline-ny
[SGR]: https://en.wikipedia.org/wiki/ANSI_escape_code#SGR_(Select_Graphic_Rendition)_parameters

[go-readline-ny] ã¯ v0.6.1 ã‹ã‚‰æ–‡å­—ã”ã¨ã«è‰²ã‚’å¤‰æ›´ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

ã“ã®é…è‰²ã¯å›ºå®šã§ã¯ãªãã€readline.Editor ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ Coloring ã«è¨­å®šã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å•ã„åˆã‚ã›ã¦æ±ºå®šã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚åŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã€æ¬¡ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚’æº€ãŸã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```go
type Coloring interface {
    // Reset has to initialize receiver's fields and return default color.
    Init() ColorSequence // <-- v0.10.0 ã«ã¦ int ã‚ˆã‚Šå¤‰æ›´
    // Next has to return color for the given rune.
    Next(rune) ColorSequence // <-- v0.10.0 ã«ã¦ int ã‚ˆã‚Šå¤‰æ›´
}
```
â€» v0.10.0 ã‚ˆã‚Šã€æˆ»ã‚Šå€¤ã‚’ int ã‚ˆã‚Š readline.ColorSequence ï¼ˆå®Ÿæ…‹ã¯ int64ï¼‰ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚

ã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã¯æ¬¡ã®ã‚ˆã†ã«ä½¿ã‚ã‚Œã¾ã™ï¼ˆã‚³ãƒ¼ãƒ‰ã¯ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚æœ¬ç‰©ã¯ã‚‚ã£ã¨ã‚´ãƒãƒ£ã‚´ãƒãƒ£ã—ã¦ã¾ã™ï¼‰

```go
func (editor *Editor) printLine(){
    X = editor.Coloring
    defaultColor := X.Init()
    last := ColorSequence(-1)
    for i, r := range ãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ {
        c := X.Next(r) // è¡¨ç¤ºç¯„å›²å¤–ã§ã‚‚äºŒé‡å¼•ç”¨ç¬¦ã®å†…å¤–ãªã©åˆ¤æ–­ã‚’Nextã®ä¸­ã§ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã®ã§ä¸€å¿œå‘¼ã°ã‚Œã‚‹
        if è¡¨ç¤ºé–‹å§‹ä½ç½® <= i && i < è¡¨ç¤ºçµ‚äº†ä½ç½® {
            if c != last {
                colorSet(c) ; last = c
            }
            printRune(r)
        }
    }
    if last != defaultColor {
        colorSet(defaultColor) // è¡¨ç¤ºãŒçµ‚ã‚ã£ãŸã‚ã¨ã€æ¨™æº–è‰²ã«æˆ»ã™ãŸã‚ Init ã®æˆ»ã‚Šå€¤ãŒä½¿ã‚ã‚Œã‚‹
    }
}
```

Init ã‚„ Next ã§è¿”ã™ã¹ãè‰²ã‚³ãƒ¼ãƒ‰ `c` ã¯ANSIã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã® [SGR]ã€ã„ã‚ã‚†ã‚‹ ã€ŒESC[ğ‘›â‚;ğ‘›â‚‚;...mã€ã® æ•°åˆ— ğ‘›â‚– ã‚’ä¸€ã¤ã® ~~32bit~~ <ins>64bit</ins> ã‚³ãƒ¼ãƒ‰ã«ãƒ‘ãƒƒã‚¯ã—ãŸã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚ãƒ‘ãƒƒã‚¯ã«ã¯ SGR1ï½SGR4 ã¨ã„ã†é–¢æ•°ã‚’ç”¨ã„ã¾ã™ã€‚

- `ESC[39m` â†’ `readline.SGR1(39)`
- `ESC[1;39m` â†’ `readline.SGR2(1, 39)`
- `ESC[37;22;41m` â†’ `readline.SGR3(37, 22, 41)` 

ã¾ãŸã€ã‚ˆãä½¿ã†ã‚‚ã®ã«ã¤ã„ã¦ã¯ readline ã®æœ¬ä½“å´ã§ã‚‚ `readline.Black` , `readline.Red` ã¨ã„ã†ã‚ˆã†ãªå½¢ã§[å®šç¾©](https://github.com/nyaosorg/go-readline-ny/blob/9bd01b73e06d35d12f9c6dd1fbec6438d1c1dee7/color.go#L14)ã—ã¦ã„ã¾ã™ã€‚

ã“ã‚Œã‚’å®Ÿéš›ã«å®Ÿè£…ã—ãŸã‚‚ã®ã¯

- [github.com/nyaosorg/go-readline-ny/coloring/vimbatch.go](https://github.com/nyaosorg/go-readline-ny/blob/1d97ade75bf5ec1181adfb52a0b58baed2d8d6ad/coloring/vimbatch.go)  
   â†’ Coloring ã®ã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…VimBatchï¼ˆvimä¸Šã§ã®ãƒãƒƒãƒãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆé¢¨ï¼‰   
- [github.com/nyaosorg/nyagos/internal/frame/coloring.go](https://github.com/nyaosorg/nyagos/blob/e589106497d60150f9c65f9eb1612623e51b4965/internal/frame/coloring.go)  
ï¼ˆnyagos ã§å®Ÿéš›ã«ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‚‚ã®ï¼‰

ã«ãªã‚Šã¾ã™ã€‚VimBatch ã§ã¯

* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ç«¯æœ«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ–‡å­—è‰²ï¼‹ç«¯æœ«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆèƒŒæ™¯è‰²ï¼‹é«˜è¼åº¦ï¼ˆ`ESC[1;49;39m`ï¼‰
* å…¨è§’ç©ºç™½`\u3000` ã¯æ–‡å­—è‰²ã€Œç™½ã€ã€èƒŒæ™¯è‰²ã€Œèµ¤ã€
* ç’°å¢ƒå¤‰æ•° `%`ï½`%` ã®é–“ã¯ã‚·ã‚¢ãƒ³
* æ–‡å­—åˆ— `"`ï½`"` ã®é–“ã¯ãƒã‚¼ãƒ³ãƒ€
* `&` ã¯æš—ã„é»„è‰²

ã¨ã„ã†ï¼”ç¨®é¡ã®ã¿ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ï¼ˆä»¥ä¸‹ã€VimBatch ã®å®šç¾©ï¼‰

[f:id:zetamatta:20230402204950p:plain]

ã“ã†ã—ã¦å®Ÿè£…ã—ãŸ Coloring ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã€[github.com/nyaosorg/go-readline-ny/examples/example2.go](https://github.com/nyaosorg/go-readline-ny/blob/9bd01b73e06d35d12f9c6dd1fbec6438d1c1dee7/examples/example2.go#L26) ã®ã‚ˆã†ã«è¨­å®šã—ã¦ãŠã‘ã°OKã§ã™ã€‚
