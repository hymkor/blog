Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2023/09/03/125304
Rem: App-Edited: 2024-01-21T12:55:44+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/820878482964289902
Rem: Published: 2023-09-03T12:53:04+09:00
Category: Rust
Updated: 2023-09-03T12:53:04+09:00
Title: 勉強メモ：Rust で日本語を一文字ずつ列挙する
---
+ [文字列でUTF-8でエンコードされたテキストを保持する - The Rust Programming Language 日本語版](https://doc.rust-jp.rs/book-ja/ch08-02-strings.html#%E6%96%87%E5%AD%97%E5%88%97%E3%82%92%E8%B5%B0%E6%9F%BB%E3%81%99%E3%82%8B%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E7%BE%A4)

```rust
for c in "नमस्ते".chars() {
    println!("{}", c);
}
```

これだと文字列の長さ分の配列的なメモリ領域が確保されるそうなのので、あまり望ましくない（ヒープの乱れは心の乱れ）。Go だと

```go
package main

import "fmt"

func main() {
    for _, c := range "नमस्ते" {
        fmt.Printf("%c\n", c)
    }
}
```

で、各コードポイント単位で列挙できるんだが、同様なのはないものか。

標準ライブラリのドキュメントをつらつら見ていたら、ちょうどよいのがあった。

[str - Rust](https://doc.rust-lang.org/std/primitive.str.html#method.char_indices)

```rust
fn main(){
    let word = "日本語テキスト";

    for (size,code) in word.char_indices() {
        println!("{},{}",size,code)
    }
}
```

```
0,日
3,本
6,語
9,テ
12,キ
15,ス
18,ト
```

実は最初、CharGPT 3.5 に本件を聞いていたんだが、`chars()` は教えてくれても、`char_indices()` の存在は教えてくれなかった。思うに、

+ リファレンスに載ってるサンプルコードがただのテストコードで、for を使った実用的なコードになっていない
+ 日本語のブログ記事で、このような内容を取り扱っているものがたまたまなかった

ったところだろうな。それで、学習データの中に入っていなかったと。

あと、`.char_indices()` はループ以外の場所でも、

```
let mut char_indices = word.char_indices(); // イテレータのインスタンスを作成
assert_eq!(Some((0, 'g')), char_indices.next());
```

という形で使えて、勝手が良さそうだ。Go だと `import "unicode/utf8"` した上で、[utf8.DecodeRuneInString](https://pkg.go.dev/unicode/utf8@go1.21.0#DecodeRuneInString) という別の関数を呼び出す形になる。
