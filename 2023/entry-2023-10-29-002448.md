```header
Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2023/10/29/002448
Rem: App-Edited: 2024-01-21T12:50:29+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/6801883189054207203
Rem: Published: 2023-10-29T00:27:42+09:00
Category: awk
Updated: 2023-10-29T00:24:48+09:00
Title: awk 関連もろもろメモ
```
- [awkが新しくなる！？ 本家AwkがUnicode (UTF-8)とCSV対応に！ #ShellScript - Qiita](https://qiita.com/ko1nksm/items/1a3e711bbd925657f5fd#fn-1)

なるほどなぁ。以下、自分的要約：

- One True AWK (nawk) が UTF8 と CSV (by `--csv` オプション)に対応 [^CSV]
- UTF8 専用になってしまっており、`LC_ALL=C` への対応が一時的になくなった
    - BSD / macOS では取り込まれないのではないかという懸念がある
    - その後、互換性は修復されたらしい
    - 書籍のネタにするための機能追加にしか見えないとのこと
- [おまけ Miller (mlr) 使えばよくね？](https://qiita.com/ko1nksm/items/1a3e711bbd925657f5fd#%E3%81%8A%E3%81%BE%E3%81%91-miller-mlr-%E4%BD%BF%E3%81%88%E3%81%B0%E3%82%88%E3%81%8F%E3%81%AD)
    - CSV,TSV,JSONとかに対応してるツール → [johnkerl/miller: Miller is like awk, sed, cut, join, and sort for name-indexed data such as CSV, TSV, and tabular JSON](https://github.com/johnkerl/miller)

自分はもう nawk とか使う機会はないので… 生暖く見守っていきましょう。

[^CSV]: 二重引用符で囲まれた範囲内の列区切り文字、行区切り文字は要素の一部とみなすという対応。今まで FPAT という変数を使えば列区切り文字問題は対応できていたが、行区切り文字はどうしようもなかった。対応しない理由としては、そこまでするならもっと別のツールを使うべきだとかいう回答だったのだが…確かに今更どないしたのという感じではある

-----

awk といえば、前にこんな記事も zenn.dev に書きました。

-  [要素内に改行などを含む CSV を gawk で処理](https://zenn.dev/zetamatta/articles/ce42498310c183)

二重引用符の個数が奇数だったらセルが閉じてないから、次の行を連結するという簡単なロジックで要素内の改行コードに対応する方式ですわ。が、gawk や goawk も `--csv` に対応するみたいなので、もう要らなくなりそう
