Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2024/01/20/211940
Rem: App-Edited: 2024-01-21T11:51:58+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/6801883189076641851
Rem: Published: 2024-01-20T21:19:40+09:00
Category: htnblog
Updated: 2024-01-20T21:19:40+09:00
Title: はてなブログ・クライアントから、ウェブの編集画面の呼び出しに対応 (v0.9.0)
---
はてなブログ・クライアントを更新した (v0.9.0)

+ [Release v0.9.0 · hymkor/go-htnblog](https://github.com/hymkor/go-htnblog/releases/tag/v0.9.0)

修正箇所は次の通り

#### htnblog init を微修正 (保安対策)

##### 変更前の .htnblog を .htnblog~ にバックアップしておくようにした

間違って修正してしまった時に備えて、古典的なUNIX的というか、Emacs風に変更前のファイルのバックアップを残すようにした。 内部的には次のように差し替えを行っている。

1. 最新版を一度 `~/.htnblog.tmp` として保存
2. `~/.htnblog` → `~/.htnblog~` へリネーム
3. `~/.htnblog.tmp~ → `~/.htnblog` へリネーム

##### (linux) 保存する .htnblog のパーミッションを 0644 ではなく、0600 とした

.htnblog には API-KEY が含まれているので、~/.ssh と同様にログインできる他のユーザに見えないようにすべきだったのに、644 で作ってしまっていた。600 とし、グループユーザ、他人ユーザからの読み込み・書き込みができないようにした。

#### 編集ページをウェブブラウザで開くサブコマンド: htnblog browse を追加

`htnblog edit` のあと、プレビューを見るのに、 いちいちブックマークからたどらなくてよくなった。`htnblog browse` すれば、すぐブラウザの編集画面が開く。
( キーボードをタイプするより、ブックマークたどった方が早いとか言う悪い子はいねがぁぁぁ )

この編集画面の URL は、API のレスポンスには直接記載されていないので、次のような形で組み立てている。

+ EndPointURL + "../edit?entryID=" + entryId

entryId は AtomPub API から得られた記事データの中に含まれる次のタグの URL のファイル名部分から抽出した。

```
<link rel="edit" href="https://blog.hatena.ne.jp/{はてなID}/{ブログID}/atom/entry/2500000000" />
```

#### htnblog list で -n オプションで指定されなかった場合の表示記事数を 100 から 10 に変更した

テスト用に一時的に 100 にしたのを、戻すのを忘れていた。自分で `htnblog list` をやって、最近の記事がスクロールで流れてしまって分からないのを見て、やっと思い出した次第

----

ほぼ完成形に近くなったので、もう v0.10.0 ということはなく、次はおそらく v1.0.0 になることだろう ( 不具合があれば、残念ながら v0.9.1 )
