```header
Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2024/02/15/151938
Rem: App-Edited: 2024-02-19T12:40:36+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/6801883189083406802
Rem: Published: 2024-02-15T15:19:38+09:00
Category: nyagos jujutsu github
Updated: 2024-02-15T15:19:38+09:00
Title: Jujutsu レポジトリで GitHub CLI (ghコマンド) を使う
```
(2024-02-19:追記あり)

[本家]: https://martinvonz.github.io/jj/v0.14.0/github/#using-github-cli

[Using GitHub CLI][本家] によると

```
$ GIT_DIR=.jj/repo/store/git gh issue list
```

のように、環境変数 GIT\_DIR に .jj ディレクトリ内の git ディレクトリを指定すればよいようです。

nyagos で、`gh` コマンドを使う時、この指定を自動的に行うようラッパーを定義しておきましょう。~/.nyagos を以下のエイリアス定義を追加すれば Ok です。

```lua
nyagos.alias.gh = function(args)
    local wd = nyagos.getwd()
    local newgitdir = nyagos.pathjoin(wd,".jj\\repo\\store\\git")
    args[0] = "gh.exe" -- replace 'gh' to 'gh.exe'
    if nyagos.access(newgitdir,0) then
        local oldgitdir = nyagos.env.GIT_DIR
        nyagos.env.GIT_DIR = newgitdir
        nyagos.rawexec(args)
        nyagos.env.GIT_DIR = oldgitdir
    else
        nyagos.rawexec(args)
    end
end
```

bash 環境の場合は、[本家]によると [direnv] コマンドを導入して `.envrc` に次のように書いておけばよいそうです。

```bash
export GIT_DIR=$PWD/.jj/repo/store/git
```

[direnv]: https://direnv.net/

### 2024-02-19:追記

+ [その後 Jujutsu で分かったこと、失敗したことなど - 標準愚痴出力](https://zetamatta.hatenablog.com/entry/2024/02/18/002652)

にも書いたのですが、`jj git init --git-repo=.` で既存の Git レポジトリを jj 化して、両方使える状態にすると、`gh` コマンドのエイリアスは必要ではなくなります。

とはいえ、nyagos でコマンドのエイリアスの書き方のサンプルとしては良いので、本記事はそのままにしておきます。
