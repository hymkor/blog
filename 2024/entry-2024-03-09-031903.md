Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2024/03/09/031903
Rem: App-Edited: 2024-03-23T15:25:53+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/6801883189089281870
Rem: Published: 2024-03-09T03:19:03+09:00
Category: jujutsu git jj vim
Updated: 2024-03-09T03:19:03+09:00
Title: (解決編) jujutsu v0.15.1 で、コミットログを gvim.exe で編集できなくなってしまった
---
(前回) → [jujutsu v0.15.1 で、コミットログを gvim.exe で編集できなくなってしまった。 - 標準愚痴出力](https://zetamatta.hatenablog.com/entry/2024/03/08/192119) 

どうやら、`\\?\C:\…` 形式のパスに含まれるクエスチョンマークを、gvim がワイルドカードと誤認してしまったらしい。自前展開にトライした結果、失敗したようだ。

結論としては、gvim に `--literal` オプションをつけて、ワイルドカード展開を抑制すればよい。環境変数EDITORやJJ\_EDITORではなく、`jj config edit --user` で以下の設定を追加した。

```ini
[ui]
editor = [ "C:/Users/hymkor/scoop/apps/vim/current/gvim.exe" , "--literal" ]
```

しかし、なぜ `\\?\C:\…` が使われるようになったのだろう。どうも、Rust のパスの正規化関数の仕様らしい。

```rust
use std::fs;

fn main() -> std::io::Result<()> {
    let path = fs::canonicalize("C:/Users/hymkor/.vimrc")?;
    println!("{}",path.display());
    Ok(())
}
```

```
$ rustc c.rs
$ c
\\?\C:\Users\hymkor\OneDrive\Share\Etc\.vimrc
```

`\\?\C:\...` 形式へ変換されると共に、シンボリックリンクも展開されている。なるほどなぁ
