```header
Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2024/08/15/142148
Rem: App-Edited: 2024-08-15T14:34:49+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/6801883189129726349
Rem: Published: 2024-08-15T14:21:48+09:00
Category: go
Updated: 2024-08-15T14:21:48+09:00
Title: Go 1.23 の "iter" パッケージって冗長すぎない？（→ 関数仕様をより簡単にする試み）
```
( ※  本文書のソース一式は https://github.com/hymkor/study-go-simple-rangefunc にも UP しました )

Go 1.23 で、簡単な rangefunc を書いてみたのだが、戻り値の型が無駄に複雑で過剰ラッピングに思われた。

```go
package main

import (
    "iter"
)

type seq struct {
    values []int
}

func newSeq(v ...int) *seq {
    return &seq{values: v}
}

func (s *seq) Each() iter.Seq[int] {
    return func(callback func(int) bool) {
        for _, v := range s.values {
            if !callback(v) {
                break
            }
        }
    }
}

func main() {
    s := newSeq(1, 3, 5, 7, 9)
    for v := range s.Each() {
        println(v)
    }
}
```

```
C:> go run f.go
1
3
5
7
9
```

そこで "iter" に頼らず、rangefunc 関数を書いてみよう。そして、呼び出しも `range s.Each()` ではなく、`range s.Each` と少し簡単にしてみる。

```go
package main

type seq struct {
    values []int
}

func newSeq(v ...int) *seq {
    return &seq{values: v}
}

func (s *seq) Each(callback func(int) bool) {
    for _, v := range s.values {
        if !callback(v) {
            break
        }
    }
}

func main() {
    s := newSeq(1, 3, 5, 7, 9)
    for v := range s.Each {
        println(v)
    }
}
```

そして、この体裁だと、"iter" を import していないので、実は Go 1.23 以前のパッケージからも呼び出すことができる

```go
package main

// 中略

func main() {
    s := newSeq(1, 3, 5, 7, 9)
    s.Each(func(v int) bool {
        println(v)
        return true
    })
}
```

#### まとめ

rangefunc 使う場合でも、なるべく `import "iter"` なしで書いた方が、古い Go からも利用できてよいかもしれない。
