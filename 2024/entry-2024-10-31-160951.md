```header
Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2024/10/31/160951
Rem: App-Edited: 2024-10-31T20:07:04+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/6802418398300361550
Rem: Published: 2024-10-31T16:09:51+09:00
Category: 雑談 nyagos
Updated: 2024-10-31T16:09:51+09:00
Title: go-box の改造
```
[nyagos](https://github.com/nyaosorg/nyagos) には、こういうファイル名をカーソルキーで選べる機能があるんだけれども(Ctrl-O)、選択した後、選択肢は表示しっぱなしで、コマンドラインだけ新しい行に再表示して「続きを入力してください」になるんだよな。

[f:id:zetamatta:20241031160258p:plain]

これ、選択肢の行を ESC [ <n> M （行削除）とかで消去できないかなと見ている（が、[ソース](https://github.com/nyaosorg/go-box)がみづらい）

---

選択関数の戻り値、今のところ、選択した選択肢の配列しか返していないんだけど、これに「画面表示に消費した行数」もしくは「画面表示を削除するクロージャ」を加えないといけない。

つまり、関数の仕様が変わってしまう。この関数、nyagos 外の Public な関数なので、そうなると関数の名前を変える必要が出てきて、これはこれでつらい。

世の中では、互換性を考えずにカジュアルに仕様を変えるようなライブラリもあって、そういうツヨツヨプロジェクトはいいなぁとか思ったりする。

一方で別に自分以外にユーザがいるわけでもないライブラリで何をそこまで気を遣っている自分もちょっとおかしいよな

まぁ、でも「一事が万事」という言葉もあるし…（そのわりに自然言語の方はガバガバ）

---

戻り値を「構造体へのポインター」にすれば、使うか、使わないか、分からない戻り値情報をいくら返しても、互換性は壊れない！

Microsoft は逆パターンとして、引数を構造体ポインターにしてて、いくらパラメータを増やしても互換性が壊れないようにしてる

（構造体の先頭に構造体全体のサイズを呼び出し元に入れさせるようにしているのがポイント）

---

こういうプログラムを書いてみたが、カーソル位置は３つ上に上がってくれたけど、ターミナルのビューポートを３つ上にずらすような動作はなかったので、あんまり頑張って実装する意味はないかもなーという気分になり始めた。

（もしかして、画面の最下行を含む行を削除すると、ビューポートもずれてくれるのではないかという期待があった）

```go
package main

func main() {
        print("1\n2\n3\n")
        print("\x1B[3A\x1B[3M")
}
```

この故事[^故事]から学ぶべきことは、いくら設計を一生懸命見直したところで、そもそも要件として必要なければ無意味ということだった。

[^故事]: 故事というのは、大昔の出来事とかに対して使う言葉であって、別に事故の事例じゃないと分かってはいたんだけど、「この故事から学ぶべきことは」という言い回しがすきなので、間違っているとは知りつつ、つい使ってしまう
