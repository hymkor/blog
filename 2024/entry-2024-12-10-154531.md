Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2024/12/10/154531
Rem: App-Edited: 2024-12-10T15:49:05+09:00
Rem: Draft: yes
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/6802418398310489014
Rem: Published: 2024-12-10T15:45:31+09:00
Category: go go golang
Updated: 2024-12-10T15:45:31+09:00
Title: 今日のないものねだり: `(*os.File) Close` で `(*os.File) Read` を中断できたらなぁ
---
```go
package main

import (
    "os"
    "time"
)

func main() {
    go func() {
        var buffer [1024]byte
        os.Stdin.Read(buffer[:])
        println("done")
    }()
    time.Sleep(time.Second)
    println("try close")
    os.Stdin.Close()
    println("called close")
}
```

Linux だと、os.Stdin をクローズすることで、別goroutineの入力待ちをただちにエラー終了させることができる。うれしい

Windows だと、os.Stdin をクローズしても、その後、何か標準入力から何らかのデータが入らないと終了できない。かなしい [^1]

[^1]:  `(*os.File) SetDeadline` も os.Stdin についてはサポートしていない模様

今のところ、これで困ることはないのだけれども、プログラム終了時に無駄な goroutine を行儀よく終わらせる手段がなくて、ちょっと気持ち悪い人生だった。