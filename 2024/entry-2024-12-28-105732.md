Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2024/12/28/105732
Rem: App-Edited: 2024-12-28T10:57:32+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/6802418398315222676
Rem: Published: 2024-12-28T10:57:32+09:00
Category: evernote go
Updated: 2024-12-28T10:57:32+09:00
Title: Evernote のエクスポートHTMLで、添付ファイルへのリンクが切れている？
---
なんか、Evernote がエクスポートする HTML で、添付ファイルへのリンクが壊れているという相談をもらった。そして、Evernote のネイティブのエクスポート形式でエクスポートされた enex ファイルをワシのツール([unenex])で HTML化しても同様だという。

- [Atteched Files problem · Issue #2 · hymkor/go-enex](https://github.com/hymkor/go-enex/issues/2)

> **（和訳）**  
> このツールは私の課題の解決策として考えられたので、このツールを試してみました。Evernote の HTML へのエクスポートは 2 年以上壊れていて、会社はそれを修正しませんでした（さらに悪いことに、私は何度か報告しようとしましたが、一度はチケットが開かれると、すぐに次のコメントとともに閉じられます: 修正済み) HTML にエクスポートできません。問題は、メモ内のすべての添付ファイルのタイトルが「無題の添付ファイル」であり、そのホットリンクがサブフォルダー内の添付ファイルを指していないことです。したがって、生成された HTML インデックス ファイルは役に立ちません。  
> &nbsp;  
> このツールを試してみましたが、ENEX のノートに添付ファイルがないかのように、添付リンクやアイコンなどのないインデックス/概要ファイルが得られました。ただし、添付ファイルのファイルは、当然のことながらサブフォルダー内にあります。  
> &nbsp;  
> 私のやり方が間違っているのでしょうか？

症状が発生するファイルをもらえたので、まず [unenex] で再試したところ、非画像ファイルに対しても `<img>` タグを使うというようなことをしていた。拡張子が .jpg , .jpeg, .png, .gif とかでなければ `<a>` を使うように修正したところ、あっさり直った。

それははよいのだが、最初の相談の本家Evernote の HTML エクスポートが壊れているというのはどういうことなんじゃろ。エクスポート機能は Evernote のデスクトップでしか使えないのだが、自分の環境のはアンインストールしてしまっていたので、改めて[Windowsサンドボックス]へインストールして検証してみた。

[unenex]: https://github.com/hymkor/go-enex
[Windowsサンドボックス]: https://learn.microsoft.com/ja-jp/windows/security/application-security/application-isolation/windows-sandbox/windows-sandbox-overview

+ 画像の場合は、ちゃんと `<img>` タグで HTML に埋め込まれていた（正常）
+ 非画像の場合、リンクなどはなく、添付ファイルのマーカーらしき表示用タグだけがあった（？）

該当部分を抜き出して、インデントを適当につけてみた。

```
<div data-resource-hash="0e4d2161bccad481eaf174eea81b8ae9">
  <div class="bZFPJ" data-node-reference-element="true" data-popover-update="pos=null|resourceState=undefined" data-type="application/x-gzip" data-testid="default-file-viewer">
    <div class="IRFZk Zr4LP" draggable="true">
      <svg viewBox="0 0 40 40" class="bOJn1">
        <use xlink:href="#3z4EI"></use>
      </svg>
      <div class="bu8w7 Rvw7B">
        <div class="kUq1e">Untitled Attachment</div>
        <div class="OIJw2 Qd4_8">
          <span class="IWIUl"></span>
        </div>
      </div>
    </div>
  </div>
  <span style="position:static;display:inline;margin:0 auto;height:0;width:0;user-select:all;-ms-user-select:text;-webkit-user-select:all;-moz-user-select:all;overflow:hidden" role="none"></span>
</div>
```

これ、仕様なんだか、不具合なんだか、よく分からんな