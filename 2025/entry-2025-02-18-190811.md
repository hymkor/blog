```header
Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2025/02/18/190811
Rem: App-Edited: 2025-02-18T19:08:11+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/6802418398329878780
Rem: Published: 2025-02-18T19:08:11+09:00
Category: Go ISLisp ChatGPT
Updated: 2025-02-18T19:08:11+09:00
Title:  ISLispの割り算がGoと互換性がないので、その差を修正する関数を ChatGPT に考えてもらった
```
ここ数年、[ISLisp](http://islisp.org/) 準拠の Lisp 処理系 [gmnlisp](https://github.com/hymkor/gmnlisp) を書いているのだけれども、「関数divは，z1をz2で割った商以下の最大の整数を返す」という[仕様](https://kikakurui.com/x3/X3012-1998-01.html#68)を満たすような割り算がGo 言語側に見当たらないので、どうしようかな…と思っていた。Go言語のデフォルトの割り算ではゼロに近い方の整数になるような商を返されてしまうのだ。そりゃ、ベタにロジックを書けば出来なくもないんだろうが、なるべくスマートなやり方でやりたい。

**そうだ。ChatGPT に考えてもらおう**

今まで「コーディングみたいな楽しい作業を AI にさせるのはもったいない」等と思ったりしていたが、こういう考えるのも面倒なロジックを考えてもらうのは悪くない。

[f:id:zetamatta:20250218184352p:plain]

おい！

[f:id:zetamatta:20250218184457p:plain]

本当にあっているだろうな…ということで、テスト関数は自分で書く（検証は人間がやらねばならぬ）。
ISLisp の規格書に書いてある割り算式から作ったテストを作った。

```go
// div は z1 を z2 で割った商以下の最大の整数を返す
func div(z1, z2 int) int {
	if z2 == 0 {
		panic("division by zero")
	}
	q := z1 / z2
	r := z1 % z2
	if r != 0 && (z1 < 0) != (z2 < 0) {
		q--
	}
	return q
}
```

```go
func TestDiv(t *testing.T) {
	testcases := [][3]int{
		{12, 3, 4},
		{14, 3, 4},
		{-12, 3, -4},
		{-14, 3, -5},
		{12, -3, -4},
		{14, -3, -5},
		{-12, -3, 4},
		{-14, -3, 4},
	}
	for _, tc := range testcases {
		if result := div(tc[0], tc[1]); result != tc[2] {
			t.Fatalf("%d/%d = %d (expected %d)", tc[0], tc[1], result, tc[2])
		}
	}
}
```

```
>> go test
PASS
ok      div     0.622s
```

よしゃ。では、ついでに剰余もやってもらおう

[f:id:zetamatta:20250218185402p:plain]

こっちは一発で OK だった。

```go
func mod(z1, z2 int) int {
	if z2 == 0 {
		panic("division by zero")
	}
	r := z1 % z2
	if r != 0 && (r < 0) != (z2 < 0) {
		r += z2
	}
	return r
}
```

```go
func TestMod(t *testing.T) {
	testcases := [][3]int{
		{12, 3, 0},
		{7, 247, 7},
		{247, 7, 2},
		{14, 3, 2},
		{-12, -3, 0},
		{-14, 3, 1},
		{12, -3, 0},
		{14, -3, -1},
		{-12, -3, 0},
		{-14, -3, -2},
	}
	for _, tc := range testcases {
		if result := mod(tc[0], tc[1]); result != tc[2] {
			t.Fatalf("%d %% %d = %d (expected %d)", tc[0], tc[1], result, tc[2])
		}
	}
}
```

ところで、このスクショ載せて大丈夫だろうか？

[f:id:zetamatta:20250218190306p:plain]

画像サイズが大きくなるので、省いてしまったけれども、他に

- 誤解を招く編集してはいけない
- ChatGPT のブランドを棄損するような引用をしてはいけない
- ブログ掲載サイトのポリシーに違反しない
- 他人の個人情報を載せてはいけない

などの注意もあった。まぁ、常識の範囲内ということですね
