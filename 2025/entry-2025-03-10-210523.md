Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2025/03/10/210523
Rem: App-Edited: 2025-03-10T21:05:23+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/6802418398335386295
Rem: Published: 2025-03-10T21:05:23+09:00
Category:
Updated: 2025-03-10T21:05:23+09:00
Title: USBディスクの調子が悪いので、DropBox に課金して退避した
---
過去の諸々のデータをつっこんでいる USBハードディスクの調子が悪い。接続ケーブルが曲がると接続が切れてしまうのだ。新しい USB ディスクを買ってもいいのだが、どちらかというとファイルサーバーの方が欲しいし、それまでの間に合わせでも退避させないと危ないなぁ。

ということで、とりあえずクラウドストレージに逃がすことにした。
（30年分くらいのデータがあるので、さすがに…ね）

#### クラウドストレージの価格比較

月額払いにすると：

| 種類 | 支払い額 
|-----|-----
| OneDrive | ￥260/月/100GB
| GoogleDrive | ￥290/月/100GB
| DropBox |￥1,500/月/2TB  → ￥75/月/100GB相当

計算あってるかな？

- 年で払うと安くなるが、（少なくとも最初のうちは）やめたくなった時にやめられるよう、月額払いでいく。
- Google はメールとかでも使っているし、１ベンダーにリスクを集中させるのはよくないから、外す
- OneDrive は悪くないが、1TB 借りると、月2900円とむっちゃ高い。それに比べると、DropBox はすごく安い。
- DropBox は会社員時代にそれなりに使っているから、一応、勝手は分かる

とりあえず、他のサブスクを一つ解約して、DropBox に月額払いで契約した。

#### 今更の所感

- 900GB のデータを全部 DropBox に UP したのだが、トータルで３日くらいかかったかな。UP している時、ネットワーク帯域やら負荷やら自動で調整されるので、操作不能になることはなかったが（動画普通に見てたし）、やはりちょっと負荷くってるなというシーンはそれなりにあった。
- 分かっていた頃ではあるけど、やはりファイルの数が多いと、同期にすごい時間がかかる。ファイルのサイズよりも、数の方が圧倒的にボトルネックになるので、可能なら ZIP などで１ファイル化してしまうのが吉
- タスクバーの DropBox アイコン →「基本設定」→「同期」→「選択的同期」で、ローカルにリンクを置くファイル数をいかに絞るかがポイント
- すべてサーバサイドにおいてウェブ画面で操作すればいろいろ楽…かと思っていたのだが、**万単位のファイルをかかえた巨大フォルダー（例：メーラーのフォルダー）だと、「移動」「リネーム」で警告が出るだけでなく、エラーになってしまう場合がある**（これは想定外だった）。こういうのは一旦ローカルに同期しないとダメのようだ。
    - 同期外のローカルフォルダだと一瞬で終わる移動操作がウェブ画面経由だとすごく時間がかかる。これは多分すべてのファイルが自分の為にフルパスを記憶しているせいだろうなぁ。
    - ローカルファイルだと自分の位置を記憶しているのは親ディレクトリだけだから一箇所を書き換えれば済む。だが、クラウドだとサブディレクトリすべてをたどって全部書き換えなくてはいけない。
    - おそらくだが、複数拠点からの同期を考えると、時系列に基づく操作履歴（REDOログ）を残していかないと、同時操作ができない。その履歴をファイル単位で残しているというとかあるんだろうなぁ（こっちがメインの理由か？）
- ウェブ操作はコツをつかめばそれほど苦痛ではないが、やはり操作の効率が悪いのは否めない。確認すると、コマンドラインクライアントもあるようなので、試してみる

#### DropBox のコマンドラインクライアントのインストール

ギッハブで公開されてた。

- [dropbox/dbxcli: A command line client for Dropbox built using the Go SDK](https://github.com/dropbox/dbxcli)

確認すると、scoop の `extras` バケットにも登録されていたので、scoop 経由でインストールする。

```
> scoop install dbxcli
Installing 'dbxcli' (3.0.0) [64bit] from 'extras' bucket
dbxcli-windows-amd64.exe (8.0 MB) [=============================================] 100%
Checking hash of dbxcli-windows-amd64.exe ... ok.
Linking ~\scoop\apps\dbxcli\current => ~\scoop\apps\dbxcli\3.0.0
Creating shim for 'dbxcli'.
'dbxcli' (3.0.0) was installed successfully!
```

初回のサブコマンド起動で、OAuth2 認証するみたいやね。

```
> dbxcli.exe account
1. Go to （認証用URL）
2. Click "Allow" (you might have to log in first).
3. Copy the authorization code.
Enter the authorization code here: （ウェブに表示されたコードを入力）K7NXGkAAAAAAAB26BRx6556G7Bxr_HL_0k8UpU
Logged in as HAYAMA Kaoru <iyahaya@nifty.com>

Account Id:        （アカウントID）
：（以下省略）
```

ファイルのコピーや移動、一覧表示など、ウェブで出来ることはいろいろ出来そうだが、一方でファイルを「オンラインのみにする」「オフラインアクセスを許可」「選択的同期（のフォルダー指定）」など、ローカルのマウスでしか出来ない操作についてはサポートしていないようだなぁ。

しばらくは「使えたら使う」というスタンスになるかな。多分、ウェブ操作でエラーになる時は、dbxcli 経由でもエラーになることは変わらないと思うので

#### 今後の計画

1. ☑ USBディスクのデータをすべて DropBox に UP
2. ☐ 同じようなデータは同じ場所に集める
3. ☐ 細かいファイルが多いフォルダーは 7z や ZIP などで１ファイル化する **[Now]**  
    - そうしないとイチイチ処理に時間がかかる。
    - 本当は最初にすべきだが、そもそも、そういう巨大フォルダーがどこにあるかが、まず分からないので、2. が失敗した時点で個別にやるしかい
    - アーカイブ化自体は意外と時間がかからないし、同期もいつの間にか終わっていた。ボトルネックは分からんものだねぇ
4. ☐ 重複したデータを削除する
5. ☐ ソースの類は GitHub に UP して、DropBox・ローカルストレージからは削除
6. ☐ 全体のサイズが十分小さくなったら、置く場所について再検討する

今回、3. のアーカイブ化は `7z a -r -sdel` で行ったが、その際、本来すべてのファイルが削除されるはずが、中にファイルが存在しない空っぽなディレクトリだけがツリーの深いところに残ることが結構ある。rm -rf でもいいが、万が一、中身のあるファイルがあったりすると大災害だ。だが、こんなこともあろうかと、そういう空ツリーを消すツールを作っておいてよかったわい（ https://github.com/hymkor/rmdirsonly ）

続く（かも