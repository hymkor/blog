Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2025/03/21/040733
Rem: App-Edited: 2025-03-21T13:59:11+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/6802418398338136086
Rem: Published: 2025-03-21T04:07:33+09:00
Category:
Updated: 2025-03-21T04:07:33+09:00
Title: Re: Windows + NYAGOS で ghq と peco を便利に使う設定
---
- [Windows + NYAGOS で ghq と peco を便利に使う設定](https://blog.tsurutatakumi.info/posts/nyagos-ghq-peco)

せっかく拙作の NYAGOS について言及いただいていたのに、半年気付いていませんでした。すみません（ここ最近、エゴサーチもあまりしていなかったもので）

> Ctrl + ] を押して、peco を起動するまでは良いのですが、リポジトリを選択して Enter を押すと Buffer に何も表示されない状態になり、再度 Enter を押すとリポジトリに移動するような挙動になっています。

peco が画面をクリアしたことを nyagos 側が把握してなくて、コマンドラインを再表示していないのが原因かもしれません。ということで、コマンドラインを明示的に再表示するメソッド `this:call("REPAINT_ON_NEWLINE")` をコールバックするようにしてみました。
（引用リストでは最後の行だけを修正）

```lua
-- 改行文字を削除する
function chomp(src)
    return string.gsub(src, "[\r\n]+$", "")
end

-- ghq で管理しているリポジトリを peco で選択して cd する
function pecoli()
    local dir = nyagos.eval("ghq list -p | peco")
    if (dir ~= nil) then
        nyagos.exec("cd " .. '"' .. chomp(dir) .. '"')
    end
end

-- pecoli へのキーバインドを設定 (Ctrl + ])
nyagos.bindkey("C-]", function(this) pecoli() ; this:call("REPAINT_ON_NEWLINE") ; end)
```

このあたり、解説が少なくて申し訳ないです。ぼちぼちと整備いたしますので、ご容赦を。

bindkey 関数から渡される this が持つメソッド・フィールドについては、

- [NYAOS.ORG/NYAGOS 07-LuaFunctions](https://nyaos.org/nyagos/07-LuaFunctions_en.html#nyagosbindkeykeynamefuncname)

の bindkey の説明あたりをご覧ください ~~（アンカーがついてないので、検索しなきゃいけないんですが）~~