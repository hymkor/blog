```header
Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2025/03/28/071443
Rem: App-Edited: 2025-04-04T10:11:59+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/6802418398339925037
Rem: Published: 2025-03-28T07:14:43+09:00
Category:
Updated: 2025-03-28T07:14:43+09:00
Title: Windows用のGoアプリに複数のアイコンを持たせよう
```
- [WindowsTerminal v1.22.10352.0 上で vim 9.1 上の日本語表示が乱れる - 標準愚痴出力](https://zetamatta.hatenablog.com/entry/2025/03/03/121421)

で書いたように、WindowsTerminal は現状 v1.21 を使っているのだけれども、新バージョンが出たら、そちらも試してみたい。だが、アイコンを両方ともタスクバーにピン止めすると、どっちがどちらか分からない。

ピン留めしたアイコンより実行ファイル（実はショートカット？）のプロパティーを確認すると、アイコン画像を複数の中から選べることが分かった。v1.22 はデフォルトのアイコンを、v1.21 には白いアイコンを指定しよう。

[f:id:zetamatta:20250328064457p:plain]

こういうことが出来ると知ると自分のアプリも複数のアイコンを持たせたくなる。[nyagos](https://nyaos.org/nyagos) は元々コマンドプロンプト風アイコンに Gopher くんを重ねたようなアイコンを持っていて、その後、MS-DOS風のアイコンを作ったりした。MS-DOS 風のアイコンはお気に入りだったけど、あまり好評だったとはいえず、結局、実行ファイルには内蔵せず、ZIPファイルに添付させるにとどめた。複数、内蔵できるのであれば、新旧両方内蔵させてもいいじゃないか。

nyagos の場合、アイコンやリソースは [josephspurrier/goversioninfo](https://github.com/josephspurrier/goversioninfo) を使って実行ファイルに内蔵させている。`cd Etc && go generate` で、次の文が実行される。

```
//go:generate cmd /c go run mkversioninfo.go > v.json && go run github.com/josephspurrier/goversioninfo/cmd/goversioninfo@latest -icon=nyagos.ico -o ..\nyagos.syso v.json && del v.json
```

goversioninfo のオプションやソースを見たところ、今のところ、アイコンファイルは一つしか指定できないようだ。試しにカンマで区切って複数のアイコンファイルを指定できるようにしたら、あっさり対応できてしまった。

[f:id:zetamatta:20250328065531p:plain]

```
//go:generate cmd /c go1.20.14.exe run mkversioninfo.go > v.json && go1.20.14.
exe run github.com/hymkor/goversioninfo/cmd/goversioninfo@master -icon=nyagos.ico,nyagos3
2x32.ico,nyagos16x16.ico -o ..\nyagos.syso v.json && del v.json
```

一応プルリクエストも送った。最近、メンテもアクティブじゃなさそうなので、もうマージしてもらうのは厳しいかなーと思ったら、二日後の今日になって比較的好意的な反応があった。

- [Enable specifying multiple icon file names separated by commas by hymkor · Pull Request #70 · josephspurrier/goversioninfo](https://github.com/josephspurrier/goversioninfo/pull/70)

strings.Cut 使ったらまずかったか？（新しすぎたか？）と思ったが、v1.18 からだった。セーフ
（Go は 1.20 までであれば、まだ Windows 7,8,Windows2008 をサポートしている）

マージされて、新バージョンがリリースされるのを楽しみに待っていよう

### 2025-04-04 追記

マージ&リリースされてた

- [Release v1.5.0 · josephspurrier/goversioninfo](https://github.com/josephspurrier/goversioninfo/releases/tag/v1.5.0)
