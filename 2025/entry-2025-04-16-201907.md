Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2025/04/16/201907
Rem: App-Edited: 2025-04-16T21:11:02+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/6802418398345605854
Rem: Published: 2025-04-16T20:19:07+09:00
Category: go
Updated: 2025-04-16T20:19:07+09:00
Title: regexp.Regexp になかった ReplaceAllStringSubmatchFunc を書いた
---
wifky の文法のパーサーを Go で書くにあたって、Perl にあった。

```perl
sub unverb{
    ${$_[0]} =~ s/\a\((\d+)\)/&unverb_sub($1)/ge;
}
```

という書き方がネックになっていた。置換コマンド `s` は `e` というオプションを指定することで、置換結果をコードで指定することができる。それに相当する関数は Go標準ライブラリ `"regexp"` にもあるが、サブグループまで得るものはなかったのだ。

一旦 Go は断念して、しばらく Perl や PowerShell でいろいろ書いていたのだが、そちらはそちらでたいへんだったので、意を決して Go で同等の関数を書いた。

- [hymkor/exregexp-go: Go package that extends the regexp library with flexible submatch-based string replacement utilities.](https://github.com/hymkor/exregexp-go)

（サンプルなどは、もう README に書いてあるので、ここでは特に引用しない）

最初、まず本体コード・テストコードを自分で書いて、一旦は完成したのだが、関数のヘッダコメントを Copilot に考えてもらおうとしたら、本体コードまで提案してきた。せっかくなので、その書き方のいいところも取り込んだ。ついでにさらに README とか、いろいろ書いてもらった。

パッケージ名 `exregexp`は Copilot に「意味としては悪くないが、発音しづらいので変えた方がいい。でも気に入ってるなら別に問題ない」と言われたので、採用した。発音しづらい方が粋な気がしたのだ。

以上