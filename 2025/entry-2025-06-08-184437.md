```header
Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2025/06/08/184437
Rem: App-Edited: 2025-06-08T18:44:37+09:00
Rem: Draft: yes
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/6802418398461787739
Rem: Published: 2025-06-05T13:08:11+09:00
Category:
Updated: 2025-06-08T18:44:37+09:00
Title: （メモ）新しいPCをセットアップした
```
## 新PCを発注した

現行PCは再生PCだったせいか、IME変換やディスクアクセスがたまに数十秒フリーズするようになってしまった。CrystalDiskInfo で確認したところ、SSD が閾値を越えていて、末期症状だった模様。まぁ、お安い価格で2年十分に使えたので値段相応ということかもしれない。でもセットアップは結構手間暇がかかるので、あまり安物を短期に乗り換えるのはあまりよろしくない。

なぜか、Windows のファイル共有で相互の共有フォルダーが参照できないという現象が。

### Firefox をインストール

PowerShell から `winget install mozilla.firefox` でインストール

### scoop をインストール

`scoop.sh` をブラウザで開いて、提示されているコマンド二つを PowerShell コマンドラインから入力する。
これができれば、あとはほとんどのアプリはコマンドラインインストールができる。

### 旧PCからファイルを移動するため、OneDrive , DropBox をセットアップ

- OneDrive は普通に GUI 操作で有効化
- DropBox は dropbox のホームページからインストーラーをダウンロード

なぜか、Windows のファイル共有がうまくゆかなかったせいなのだが、あとでマイクロソフトアカウントではなく `（PC名）\（ユーザ名）` にしたらイケタ（あれー、前の移行時は逆にマイクロソフトアカウントの方でスムーズにいけたのにな…）

### ノートPCなので、CapsLock を Ctrl キーにアサインする

旧PCはミニPCだったので常にハッピーハッキングキーボード接続だったため、CapsLock キーを Ctrl キーにアサインする必要はなかった。
今度は新PCはノートなので時々内蔵キーボードをそのまま使うことがあるので、キーをアサインしなくてはいけない。

scoop でインストールした。

```
scoop bucket add sysinternals
scoop install ctrl2cap
su
ctrl2cap /install
```

- su は nyagos の内蔵コマンド版。管理者モードのシェルを起動する
- この後、リブートが必要

### ssh/sshd を新旧ローカルPCにセットアップ

まず、Firewall での許可

次にサービスとして自動起動化（`スタート` → `すべてのアプリ` → `Windowsツール` → `サービス` → `OpenSSH Authentication Agent`）  

OpenSSH は OS に標準でインストールされているが、有効化の方法で毎度苦労する。 コマンドラインからだと、たぶん `net start "OpenSSH Authentication Agent"` だが、これサービスの起動の自動化まではできないかもしれない（今回は GUI でやったから）

### Windows でファイル共有

前はマイクロソフトアカウントでできたはずなんだが、どうもうまくいかないので、`マシン名\ユーザ名` でトライしたらイケタ。

### ssh-agent のセットアップ

Git互換バージョン管理システム jj は、パスフレーズ入力機能がないため、利用する際はパスフレーズ入力不要な環境をセットアップしなくてはいけない。

1. スタートメニューから「サービス」を検索  
    → OpenSSH Authentication Agent を起動（これはすでにやっている）
2. コマンドラインから ssh-agent を起動: `> ssh-agent`
3. 秘密鍵を登録: `> ssh-add 秘密鍵のパス`
    → パスフレーズを聞いてくるので、入力する

### マイクラデータを restic で復元

    restic restore -r ~\Dropbox\restic\restic-minecraft-uwp -t . latest

restic で保存したバックアップを新PCでリストアしようとしたが、ファイル所有者の復元などでエラーとなる問題が発生した。

まず、管理者モードで起動したコマンドライン[^su]で restic restore を起動することで、restic 動作中のファイルの所有者変更・タイムスタンプ復元のエラーについては解消した。

[^su]: nyagos だと `su` で管理者画面のターミナルが起動する

だが、ファイルが存在しないユーザの所有者となっているため、実行ユーザでファイルが変更できない問題がある。これについてはコマンドライン操作もあったはずだが[^cacls]、完全に忘れてしまっていたので、フォルダーの「プロパティ」→「セキュリティー」から所有者を自分に変える操作を行った（最適的に

[^cacls]: たしか cacls コマンドか何かだった気がする
