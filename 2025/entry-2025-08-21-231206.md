Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2025/08/21/231206
Rem: App-Edited: 2025-08-21T23:13:22+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/6802418398556955609
Rem: Published: 2025-08-21T23:12:06+09:00
Category: PowerShell GitHub gist
Updated: 2025-08-21T23:12:06+09:00
Title: 単品ファイルをコマンドラインから gist 管理するための補助スクリプトを書いた
---
自分は `%USERPROFILE%\Share\cmds` というディレクトリにバッチファイルやスクリプトを置いているんだけど、直接このディレクトリのファイルを編集してしまうことも多いので、git で管理するとなると作業フォルダーと実行ファイルとの同期がわずらわしくなる。

ということで、RCS のようにファイルを単品で履歴管理したいが、その履歴は gist に置くための補助スクリプトを書いた。内部的には GitHub CLI (gh コマンド) を使う。

#### (1) はじめて登録する時

```
gh gist create --public ファイル名
```

で gist へ登録する。この時 URL が表示されるので、その URL を次のような形式で、ファイル自身の中に書いておく

```
gist URL
```

#### (2) 更新したファイルを gist へ反映する

```
pwsh upgist.ps1 ファイル名
```


[upgist.ps1] スクリプトはファイル中の URL を読み出して、gh コマンドを使って、そこへファイルを push する

[upgist.ps1]: https://gist.github.com/hymkor/19a74081d73ba2057d5bfa74bc63d529

```upgist.ps1
param( $filename )
Get-Content $filename | ForEach-Object{
    if ( $_ -match "gist\s+(http\S+)" ){
        Write-Host ("gh gist edit {0} {1}" -f $matches[1],$filename)
        gh gist edit $matches[1] $filename
    }
}
#gist https://gist.github.com/hymkor/19a74081d73ba2057d5bfa74bc63d529
```

#### (3) ローカルファイルの変更内容を破棄して、gist ファイルの最新まで戻す

```
pwsh downgist.ps1 ファイル名
```

[downgist.ps1] スクリプトは同じくファイル中の URL を読み出して、gh コマンドを使って、そこからファイルをダウンロードする

[downgist.ps1]: https://gist.github.com/hymkor/ad3afa88c8c4d7ef1d91cccce63af5d7

```downgist.ps1
param( $filename )
$url = $null
Get-Content $filename | ForEach-Object{
    if ( $_ -match "gist\s+(http\S+)" ){
        $url = $matches[1]
    }
}
if ( $url ){
    Move-Item $filename -Destination ($filename + "~") -Force
    gh gist view $url -r -f $filename > $filename
}
#gist https://gist.github.com/hymkor/ad3afa88c8c4d7ef1d91cccce63af5d7
```
