```header
Rem: Alternate-Url: https://zetamatta.hatenablog.com/entry/2025/08/22/023420
Rem: App-Edited: 2025-08-22T02:34:20+09:00
Rem: Draft: no
Rem: Url-To-Edit: https://blog.hatena.ne.jp/zetamatta/zetamatta.hatenablog.com/atom/entry/6802418398557077303
Rem: Published: 2025-08-22T02:34:20+09:00
Category: go lisp
Updated: 2025-08-22T02:34:20+09:00
Title:  Go言語の構造体からのS式のエンコーダー・デコーダーを作りました。
```
Go言語の構造体からのS式のエンコーダー・デコーダーを作りました。

- [hymkor/sxencode-go: Go library that encodes arbitrary Go values into Lisp-style S-expressions](https://github.com/hymkor/sxencode-go)

```go
type Foo struct {
    Bar   string         `sxpr:"bar"`
    Baz   float64        `sxpr:"baz"`
    Qux   []int          `sxpr:"qux"`
    Quux  map[string]int `sxpr:"quux"`
    Quuux string         `sxpr:"quuux"`
    Corge func()         `sxpr:"corge"`
}
```

という風にフィールドのタグを付けておくと

```go
// import "github.com/hymkor/sxencode-go"

value := &Foo{
    Bar:   "hogehoge",
    Baz:   0.1,
    Qux:   []int{1, 2, 3, 4},
    Quux:  map[string]int{"ahaha": 1, "ihihi": 2, "ufufu": 3},
    Quuux: "a\"\\\n\tb",
    Corge: nil,
}

sxpr, err := sxencode.Marshal(value)
if err != nil {
    return err
}

fmt.Println(string(sxpr))
```

で、次のようなS式の文字列を生成できます。

```lisp
((bar "hogehoge")(baz 0.1)(qux (1 2 3 4))(quux (("ahaha" 1)("ihihi" 2)("ufufu" 3)))(quuux "a\"\\
    b"))
```

出力した S式は [SBCL], [OKI ISLisp], [gmnlisp] で読み込めます（そして、多分、他のLisp処理系でも。[README] にテストスクリプトあります）

[SBCL]: https://www.sbcl.org/
[OKI ISLisp]: https://islisp.org/OKIISLisp.html
[gmnlisp]: https://github.com/hymkor/gmnlisp
[README]: https://github.com/hymkor/sxencode-go#reading-the-output-in-sbcl

S式は JSON と違って改行コードがそのままフィールド区切りになるので、ログ用にJSONL みたいな別仕様を用意する必要がないところが強いと考えています。

ということで、Go の標準パッケージ ["log/slog"] の出力形式をS式にするパッケージも作成しました。

["log/slog"]: https://pkg.go.dev/log/slog

- [hymkor/sxlog-go: A slog.Handler for S-Expression Output](https://github.com/hymkor/sxlog-go)

```go
logger := slog.New(sxlog.New(os.Stderr))
slog.SetDefault(logger)
slog.Info("hello", "count", 3)
```

の結果が

```
("2025-07-24 00:06:58" INFO "hello" ("count" 3))
```

となります。S式、もっと普及したらいいと思うんですけどね
